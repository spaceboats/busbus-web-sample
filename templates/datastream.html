{% extends "_base.html" %}
{% block bodycss%}
    #body{
        margin-left: auto;
        margin-right: auto;
        padding:50px;
        //width:1200px;
	width:1200px;
        height:500px;
    }

    table {
        border: 10px solid green;
        width: 100%;
        padding:10px;
        color: #ffffff;
    }

    tr, td {
        //border-left: 1px solid white;
        //border-right: 1px solid white;
        color: #ffffff;
        font-weight:bold;
        font-family:Arial, sans-serif;
        text-align:left;
        text-shadow:2px 0 15px #292929;
        text-decoration:none;
        letter-spacing:1px;
    }

    th {
        //text-align:center;
	text-align:left;
        font-weight:bold;
        font-size:24px;
        font-family:Arial, sans-serif;
        text-shadow:2px 0 15px #292929;
        text-decoration:underline;
        letter-spacing:1px;
    }

{% endblock %}
{% block body %}

    <div id="body">
        <table id="busDataTable">	
        </table>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>
        function refreshTable()
        {
            var ct = new Date().getTime() / 1000;
            //ct = Math.floor(ct);
            var ft = ct + 60;
            $.get("http://ec2-54-68-11-133.us-west-2.compute.amazonaws.com/arrivals", { start_time: ct, end_time: ft }, function(data)
            {
                var r = new Array(), j = 8;
                r[0] = '<tr><th>';
                r[1] = 'Time';
                r[2] = '</th><th>';
                r[3] = 'Bus Route';
                r[4] = '</th><th>';
                r[5] = 'Stop Name';
                r[6] = '</th><th>';
                r[7] = 'Headsign';
                r[8] = '</th>';
                data.arrivals.sort(compare);
                for (var key=0, size=data.arrivals.length; key<size; key++)
                {
                    r[++j] ='<tr><td>';
                    //FIXME Shows date but doesn't need to be so verbose.
		    var d = new Date(data.arrivals[key].time * 1000);
                    r[++j] = d.toLocaleDateString() + " " + d.toLocaleTimeString();
		    r[++j] = '</td><td>';
                    //r[++j] = data.arrivals[key].route.short_name;
		    r[++j] = data.arrivals[key].route.id;
                    r[++j] = '</td><td>';
                    //r[++j] = data.arrivals[key].stop.name; 
                    r[++j] = data.arrivals[key].stop.id;     				 	
                    r[++j] = '</td><td>';
                    r[++j] = data.arrivals[key].headsign;
                    r[++j] = '</td></tr>';
                }
                $('#busDataTable').html(r.join(''));				
            });
            setTimeout(refreshTable, 5000);
        }

        $(refreshTable());

        function compare(a,b) {
            if (a.time < b.time)
                return -1;
            else if (a.time > b.time)
                return 1;
            else
                return 0;
        }
    </script>

{% endblock %}
{# vim: set syn=htmldjango: #}
